<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mirror Me - Harder Levels</title>
    <!-- Google Fonts: Outfit -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;600;800&display=swap" rel="stylesheet">

    <style>
        :root {
            --bg-grad-1: #0f172a;
            --bg-grad-2: #1e293b;
            --grid: rgba(30, 41, 59, 0.7);
            --wall: #334155;
            --spike: #ef4444;
            /* Red for danger */
            --p1: #06b6d4;
            /* Cyan */
            --p2: #f43f5e;
            /* Rose */
            --goal-p1: rgba(6, 182, 212, 0.3);
            --goal-p2: rgba(244, 63, 94, 0.3);
            --text-glow: 0 0 15px rgba(255, 255, 255, 0.1);
            --glass: rgba(255, 255, 255, 0.05);
            --glass-border: rgba(255, 255, 255, 0.1);
        }

        body {
            background: linear-gradient(135deg, var(--bg-grad-1), var(--bg-grad-2));
            background-size: 400% 400%;
            animation: gradientBG 15s ease infinite;
            color: white;
            font-family: 'Outfit', sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100vh;
            margin: 0;
            overflow: hidden;
            user-select: none;
        }

        @keyframes gradientBG {
            0% {
                background-position: 0% 50%;
            }

            50% {
                background-position: 100% 50%;
            }

            100% {
                background-position: 0% 50%;
            }
        }

        h1 {
            margin-bottom: 10px;
            font-weight: 800;
            letter-spacing: 2px;
            text-transform: uppercase;
            text-shadow: var(--text-glow);
            font-size: 2.5rem;
        }

        #game-container {
            position: relative;
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            background: var(--glass);
            border: 1px solid var(--glass-border);
            border-radius: 12px;
            box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.37);
            padding: 10px;
            transition: transform 0.2s;
        }

        canvas {
            display: block;
            border-radius: 4px;
        }

        #ui {
            margin-top: 20px;
            text-align: center;
            color: #94a3b8;
            width: 80%;
            max-width: 800px;
        }

        .level-badge {
            background: rgba(51, 65, 85, 0.5);
            border: 1px solid var(--glass-border);
            padding: 8px 24px;
            border-radius: 50px;
            font-weight: 600;
            color: #e2e8f0;
            margin-bottom: 20px;
            display: inline-block;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            letter-spacing: 1px;
        }

        .controls {
            margin-top: 15px;
            font-size: 1rem;
            line-height: 1.8;
            font-weight: 300;
        }

        kbd {
            background: rgba(30, 41, 59, 0.8);
            padding: 4px 10px;
            border-radius: 6px;
            font-family: 'Outfit', sans-serif;
            font-weight: 600;
            border-bottom: 2px solid #475569;
            color: #e2e8f0;
            margin: 0 2px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
        }

        .reset-hint {
            color: var(--p2);
            font-size: 0.9rem;
            margin-top: 10px;
            opacity: 0.8;
            font-weight: 600;
            cursor: pointer;
            transition: opacity 0.2s;
        }

        .reset-hint:hover {
            opacity: 1;
        }
    </style>
</head>

<body>

    <h1>Mirror Me</h1>
    <div class="level-badge">LEVEL <span id="level-display">1</span> / 55</div>

    <div id="game-container">
        <canvas id="gameCanvas"></canvas>
    </div>

    <div id="ui">
        <div class="controls">
            Move: <kbd>WASD</kbd> or <kbd>ARROWS</kbd> | Restart: <kbd>R</kbd><br>
            <span style="color:var(--p2)">Red</span> mirrors <span style="color:var(--p1)">Blue</span> horizontally.<br>
            <div class="reset-hint" onclick="loadLevel(currentLevelIdx)">Click here or press R if stuck</div>
        </div>
    </div>

    <script>
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');

        let TILE_SIZE = 35;
        let gridWidth = 15;
        let gridHeight = 9;

        const COLORS = {
            bg: 'rgba(30, 41, 59, 0.5)',
            wall: '#334155',
            spike: '#ef4444',
            mirrorLine: 'rgba(148, 163, 184, 0.3)',
            p1: '#06b6d4',
            p2: '#f43f5e',
            goal1: 'rgba(6, 182, 212, 0.4)',
            goal2: 'rgba(244, 63, 94, 0.4)'
        };

        const LEVELS = [
            ["111111111111111", "1S00000100000S1", "100000010000001", "100000010000001", "100000010000001", "100000010000001", "100000010000001", "1E00000100000E1", "111111111111111"],
            ["111111111111111", "1S00000100000S1", "100X00010000X01", "100000010000001", "111100010001111", "100000010000001", "100000010000001", "1E00000100000E1", "111111111111111"],
            ["111111111111111", "1S00000100000S1", "100110010011001", "10X000010000X01", "111110111011111", "100000010000001", "100000010000001", "1E00000100000E1", "111111111111111"],
            ["111111111111111", "1S00000100000S1", "111100010001111", "100000010000001", "100000010000001", "111100010001111", "100000010000001", "1E00000100000E1", "111111111111111"],
            ["111111111111111", "1S00000100000S1", "101110010011101", "100000000000001", "100X00010000X01", "100000000000001", "101110010011101", "1E00000100000E1", "111111111111111"],
            ["111111111111111", "1S00000100000S1", "100XX0010000XX01", "100000010000001", "111100111001111", "100000010000001", "100000010000001", "1E00000100000E1", "111111111111111"],
            ["111111111111111", "1S00000100000S1", "111101111101111", "100000000000001", "100X00000000X01", "100000000000001", "111101111101111", "1E00000100000E1", "111111111111111"],
            ["111111111111111", "1S00000100000S1", "100100010001001", "10X010010010X01", "111110111011111", "100000010000001", "101110010011101", "1E00000100000E1", "111111111111111"],
            ["111111111111111", "1S01000100010S1", "101110010011101", "100000000000001", "10X110111011X01", "100000000000001", "101100010001101", "1E00X01010X00E1", "111111111111111"],
            ["111111111111111", "1S00000100000S1", "111111010111111", "100000000000001", "10X010101010X01", "100100000001001", "101111010111101", "1E00000100000E1", "111111111111111"],
            ["111111111111111", "1S01000100010S1", "100010010010001", "101110010011101", "10X000111000X01", "101110010011101", "100010010010001", "1E00000100000E1", "111111111111111"],
            ["111111111111111", "1S00000100000S1", "101111010111101", "100000010000001", "10X010010010X01", "100010010010001", "111110111011111", "1E00000100000E1", "111111111111111"],
            ["111111111111111", "1S00000100000S1", "101111010111101", "10X001010100X01", "101011111110101", "100000000000001", "101111010111101", "1E00000100000E1", "111111111111111"],
            ["111111111111111", "1S00000100000S1", "100100010001001", "10X110010011X01", "100001010100001", "111001010100111", "100000010000001", "1E00X00100X00E1", "111111111111111"],
            ["111111111111111", "111111111111111", "1S00000100000S1", "101111010111101", "10X010000010X01", "101011010110101", "100000010000001", "1E00000100000E1", "111111111111111"],
            ["111111111111111", "1S00000100000S1", "111000010001111", "100011010110001", "10X010010010X01", "100011010110001", "111000010001111", "1E00000100000E1", "111111111111111"],
            ["111111111111111", "1S00000100000S1", "101111111111101", "100000010000001", "10X010111010X01", "100000000000001", "101110101011101", "1E00000100000E1", "111111111111111"],
            ["111111111111111", "1S00000100000S1", "100001111100001", "100000010000001", "111000010000111", "10X000000000X01", "100111010111001", "1E00000100000E1", "111111111111111"],
            ["111111111111111", "1S00000000000S1", "111111000111111", "10X010000010X01", "100000000000001", "101010101010101", "100000010000001", "1E00000100000E1", "111111111111111"],
            ["111111111111111", "111S0001000S111", "110000010000011", "110110010011011", "10X000010000X01", "110110010011011", "110000010000011", "111E0001000E111", "111111111111111"],
            ["111111111111111", "1S00000100000S1", "101110010011101", "10X000010000X01", "100111111111001", "100000010000001", "111110010011111", "1E00000100000E1", "111111111111111"],
            ["111111111111111", "1S00000100000S1", "101111111111101", "10X010000010X01", "101011111110101", "100000010000001", "101110010011101", "1E00000100000E1", "111111111111111"],
            ["111111111111111", "1S00000100000S1", "100101000101001", "10X011111110X01", "100000000000001", "111101010101111", "100000010000001", "1E00000100000E1", "111111111111111"],
            ["111111111111111", "1S00000100000S1", "111000010000111", "10X000010000X01", "100100010001001", "100000010000001", "111000010000111", "1E00000100000E1", "111111111111111"],
            ["111111111111111", "1S00000100000S1", "101110111011101", "100000000000001", "11X011111110X11", "100000000000001", "101110111011101", "1E00000100000E1", "111111111111111"],
            ["111111111111111", "1S00000100000S1", "101111101111101", "100000101000001", "11110X101X01111", "100000101000001", "101111101111101", "1E00000100000E1", "111111111111111"],
            ["111111111111111", "1S00000100000S1", "10X100010001X01", "111111010111111", "100000010000001", "111111010111111", "10X100010001X01", "1E00000100000E1", "111111111111111"],
            ["111111111111111", "1S00000100000S1", "111100010001111", "10X000010000X01", "101110010011101", "100000010000001", "111100010001111", "1E00000100000E1", "111111111111111"],
            ["111111111111111", "1S01010101010S1", "100000010000001", "111011101110111", "100000010000001", "111011101110111", "100000010000001", "1E01010101010E1", "111111111111111"],
            ["111111111111111", "1S00000100000S1", "101111010111101", "10X000010000X01", "111101010101111", "100000010000001", "101111010111101", "1E00000100000E1", "111111111111111"],
            ["111111111111111", "1E00000100000E1", "101111000111101", "10X000101000X01", "111010101010111", "100000101000001", "101111000111101", "1S00000100000S1", "111111111111111"],
            ["111111111111111", "1S00000100000S1", "101111010111101", "100000010000001", "10X010101010X01", "100000010000001", "101111010111101", "1E00000100000E1", "111111111111111"],
            ["111111111111111", "1S00000100000S1", "101111111111101", "100100000001001", "10X001010100X01", "100100010001001", "101111010111101", "1E00000100000E1", "111111111111111"],
            ["111111111111111", "1S00000100000S1", "101110010011101", "100100010001001", "10X010000010X01", "100100010001001", "101110010011101", "1E00000100000E1", "111111111111111"],
            ["111111111111111", "111S0001000S111", "110000010000011", "10X000010000X01", "101011111110101", "100000000000001", "110000010000011", "111E0001000E111", "111111111111111"],
            ["111111111111111", "1S00000100000S1", "101110101011101", "100010000010001", "10X010111010X01", "100010000010001", "101110101011101", "1E00000100000E1", "111111111111111"],
            ["111111111111111", "1E00000100000E1", "111010010010111", "100010010010001", "10X110010011X01", "100100010001001", "111010010010111", "1S00000100000S1", "111111111111111"],
            ["111111111111111", "1S00000100000S1", "101000010000101", "10X000010000X01", "101000010000101", "100000010000001", "101000010000101", "1E00000100000E1", "111111111111111"],
            ["111111111111111", "1S00100100100S1", "100010000010001", "110010010010011", "11X000010000X11", "110010010010011", "100010000010001", "1E00100100100E1", "111111111111111"],
            ["111111111111111", "1S00001110000S1", "100000111000001", "10X000111000X01", "100000000000001", "100000111000001", "100000111000001", "1E00001110000E1", "111111111111111"],
            ["111111111111111", "1S00000100000S1", "101111101111101", "10X000101000X01", "101110101011101", "100000101000001", "101111101111101", "1E00000100000E1", "111111111111111"],
            ["111111111111111", "1S00000100000S1", "100100010001001", "10X100010001X01", "100100010001001", "101100010001101", "100000010000001", "1E00000100000E1", "111111111111111"],
            ["111111111111111", "1S00000100000S1", "100111010111001", "10X001010100X01", "111001010100111", "100001010100001", "100111010111001", "1E00000100000E1", "111111111111111"],
            ["111111111111111", "1S01010101010S1", "100000010000001", "10X000000000X01", "100000000000001", "100000000000001", "100000010000001", "1E01010101010E1", "111111111111111"],
            ["111111111111111", "1S00000100000S1", "101111010111101", "10X000010000X01", "101010111010101", "100000010000001", "101111010111101", "1E00000100000E1", "111111111111111"],
            ["111111111111111", "111111111111111", "1S00000100000S1", "101010010010101", "10X010101010X01", "101010010010101", "100000000000001", "1E00000100000E1", "111111111111111"],
            ["111111111111111", "1S00000100000S1", "111000000000111", "10X000000000X01", "100111101111001", "100000000000001", "111000000000111", "1E00000100000E1", "111111111111111"],
            ["111111111111111", "1S00100100100S1", "100110000011001", "10X000101000X01", "100110101011001", "100000101000001", "100110000011001", "1E00100100100E1", "111111111111111"],
            ["111111111111111", "1S00000100000S1", "100000000000001", "10X000000000X01", "100000000000001", "100000000000001", "100000000000001", "1E00000100000E1", "111111111111111"],
            ["111111111111111", "1S00000100000S1", "101111101111101", "100000000000001", "10X011111110X01", "100000000000001", "101111101111101", "1E00000100000E1", "111111111111111"],
            ["111111111111111111111", "1S00000000100000000S1", "101111111011110111101", "100000001000100000001", "101011101111101011101", "10X000000010000000X01", "111110111010111011111", "100000100010001000001", "101111101011101111101", "100000000000000000001", "101111111011101111101", "1E00000000100000000E1", "111111111111111111111"],
            ["111111111111111111111", "1S00001000000100000S1", "100000101111101000001", "10X000100000010000X01", "101111111010111111101", "100000000010000000001", "101011111111111110101", "100000000000000000001", "101111111010111111101", "100000000010000000001", "111110101111101011111", "1E00000000000000000E1", "111111111111111111111"],
            ["111111111111111111111", "1S00100010001000100S1", "100010001000100010001", "10X010101010101010X01", "101000000000000000101", "101111101010101111101", "100000001000100000001", "101111101010101111101", "100000000000000000001", "101010101010101010101", "100010001111100010001", "1E00100010001000100E1", "111111111111111111111"],
            ["111111111111111111111", "1S00000000000000000S1", "100001111111111100001", "10X100010000010001X01", "101001000111000100101", "101011010101010110101", "101000010000010000101", "101011011111110110101", "101000000000000000101", "101111111010111111101", "100000000010000000001", "1E00000000000000000E1", "111111111111111111111"],
            ["111111111111111111111", "1S00001000000010000S1", "100000111101111000001", "10X000000101000000X01", "101111110101011111101", "100000001010100000001", "101010111111111010101", "100010000000000010001", "101111101010101111101", "100000001010100000001", "101111111010111111101", "1E00000000000000000E1", "111111111111111111111"]
        ];

        let currentLevelIdx = 0;
        let map = [];
        let p1 = { x: 0, y: 0 };
        let p2 = { x: 0, y: 0 };
        let exit1 = { x: 0, y: 0 };
        let exit2 = { x: 0, y: 0 };
        let isTransitioning = false;

        function calculateTileSize() {
            const maxWidth = window.innerWidth * 0.85;
            const maxHeight = window.innerHeight * 0.70;

            const sizeW = maxWidth / gridWidth;
            const sizeH = maxHeight / gridHeight;

            return Math.floor(Math.min(sizeW, sizeH));
        }

        function loadLevel(idx) {
            if (idx >= LEVELS.length) {
                alert("ðŸŽ‰ CONGRATULATIONS! You have beaten all levels!");
                currentLevelIdx = 0;
                idx = 0;
            }

            isTransitioning = false;
            currentLevelIdx = idx;
            document.getElementById('level-display').innerText = idx + 1;
            const layout = LEVELS[idx];
            map = [];

            gridHeight = layout.length;
            gridWidth = layout[0].length;

            TILE_SIZE = calculateTileSize();

            canvas.width = gridWidth * TILE_SIZE;
            canvas.height = gridHeight * TILE_SIZE;

            exit1 = { x: 0, y: 0 }; exit2 = { x: 0, y: 0 };

            for (let y = 0; y < layout.length; y++) {
                let row = [];
                for (let x = 0; x < layout[y].length; x++) {
                    const char = layout[y][x];

                    if (char === '1') row.push(1);
                    else if (char === 'X') row.push(2);
                    else row.push(0);

                    if (x < Math.floor(gridWidth / 2)) {
                        if (char === 'S') p1 = { x, y };
                        if (char === 'E') exit1 = { x, y };
                    }
                    else if (x > Math.floor(gridWidth / 2)) {
                        if (char === 'S') p2 = { x, y };
                        if (char === 'E') exit2 = { x, y };
                    }
                    else {
                        if (char === 'S') p1 = { x, y };
                    }
                }
                map.push(row);
            }
            draw();
        }

        window.addEventListener('resize', () => {
            TILE_SIZE = calculateTileSize();
            canvas.width = gridWidth * TILE_SIZE;
            canvas.height = gridHeight * TILE_SIZE;
            draw();
        });

        function move(dx, dy) {
            if (isTransitioning) return;
            const t1 = { x: p1.x + dx, y: p1.y + dy };
            const t2 = { x: p2.x - dx, y: p2.y + dy };

            let p1Moved = false;
            let p2Moved = false;

            if (isValid(t1.x, t1.y)) {
                p1 = t1;
                p1Moved = true;
            }

            if (isValid(t2.x, t2.y)) {
                p2 = t2;
                p2Moved = true;
            }

            if (map[p1.y][p1.x] === 2 || map[p2.y][p2.x] === 2) {
                deathEffect();
                return;
            }

            draw();
            checkWin();
        }

        function isValid(x, y) {
            if (x < 0 || x >= gridWidth || y < 0 || y >= gridHeight) return false;
            return map[y][x] !== 1;
        }

        function deathEffect() {
            draw();

            ctx.fillStyle = 'rgba(239, 68, 68, 0.4)';
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            setTimeout(() => {
                loadLevel(currentLevelIdx);
            }, 300);
        }

        function checkWin() {
            if (p1.x === exit1.x && p1.y === exit1.y &&
                p2.x === exit2.x && p2.y === exit2.y) {
                isTransitioning = true;
                ctx.fillStyle = 'rgba(16, 185, 129, 0.2)';
                ctx.fillRect(0, 0, canvas.width, canvas.height);

                setTimeout(() => {
                    currentLevelIdx++;
                    loadLevel(currentLevelIdx);
                }, 400);
            }
        }

        function draw() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);

            for (let y = 0; y < map.length; y++) {
                for (let x = 0; x < map[y].length; x++) {
                    const px = x * TILE_SIZE, py = y * TILE_SIZE;

                    if (map[y][x] === 1) {
                        ctx.fillStyle = COLORS.wall;
                        ctx.fillRect(px, py, TILE_SIZE, TILE_SIZE);
                        ctx.strokeStyle = 'rgba(255,255,255,0.05)';
                        ctx.lineWidth = 1;
                        ctx.strokeRect(px, py, TILE_SIZE, TILE_SIZE);
                    } else if (map[y][x] === 2) {
                        drawSpike(px, py);
                    }
                }
            }

            const midX = Math.floor(gridWidth / 2) * TILE_SIZE + TILE_SIZE / 2;
            ctx.strokeStyle = COLORS.mirrorLine;
            ctx.setLineDash([TILE_SIZE / 4, TILE_SIZE / 4]);
            ctx.lineWidth = 2;
            ctx.beginPath();
            ctx.moveTo(midX, 0);
            ctx.lineTo(midX, canvas.height);
            ctx.stroke();
            ctx.setLineDash([]);

            const inset = TILE_SIZE * 0.2;
            drawEntity(exit1.x, exit1.y, COLORS.goal1, false);
            drawEntity(exit2.x, exit2.y, COLORS.goal2, false);

            ctx.lineWidth = 3;
            ctx.strokeStyle = COLORS.p1;
            ctx.strokeRect(exit1.x * TILE_SIZE + inset, exit1.y * TILE_SIZE + inset, TILE_SIZE - (inset * 2), TILE_SIZE - (inset * 2));

            ctx.strokeStyle = COLORS.p2;
            ctx.strokeRect(exit2.x * TILE_SIZE + inset, exit2.y * TILE_SIZE + inset, TILE_SIZE - (inset * 2), TILE_SIZE - (inset * 2));

            drawEntity(p1.x, p1.y, COLORS.p1, true);
            drawEntity(p2.x, p2.y, COLORS.p2, true);
        }

        function drawSpike(px, py) {
            ctx.fillStyle = COLORS.spike;

            ctx.beginPath();
            ctx.moveTo(px + TILE_SIZE / 2, py + TILE_SIZE * 0.2);
            ctx.lineTo(px + TILE_SIZE * 0.8, py + TILE_SIZE / 2);
            ctx.lineTo(px + TILE_SIZE / 2, py + TILE_SIZE * 0.8);
            ctx.lineTo(px + TILE_SIZE * 0.2, py + TILE_SIZE / 2);
            ctx.closePath();
            ctx.fill();

            ctx.fillStyle = 'rgba(0,0,0,0.2)';
            ctx.beginPath();
            ctx.arc(px + TILE_SIZE / 2, py + TILE_SIZE / 2, TILE_SIZE * 0.1, 0, Math.PI * 2);
            ctx.fill();
        }

        function drawEntity(x, y, color, isCircle) {
            ctx.fillStyle = color;
            const px = x * TILE_SIZE + TILE_SIZE / 2;
            const py = y * TILE_SIZE + TILE_SIZE / 2;
            const size = TILE_SIZE * 0.7;

            if (isCircle) {
                ctx.shadowColor = color;
                ctx.shadowBlur = 15;
                ctx.beginPath();
                ctx.arc(px, py, size / 2, 0, Math.PI * 2);
                ctx.fill();
                ctx.shadowBlur = 0;

                ctx.fillStyle = 'rgba(255,255,255,0.8)';
                ctx.beginPath();
                ctx.arc(px - size / 6, py - size / 6, size / 8, 0, Math.PI * 2);
                ctx.fill();

            } else {
                const rectSize = TILE_SIZE * 0.6;
                const offset = (TILE_SIZE - rectSize) / 2;
                ctx.fillRect(x * TILE_SIZE + offset, y * TILE_SIZE + offset, rectSize, rectSize);
            }
        }

        window.addEventListener('keydown', (e) => {
            if (e.key === 'r' || e.key === 'R') loadLevel(currentLevelIdx);
            if (['ArrowUp', 'w', 'W'].includes(e.key)) move(0, -1);
            if (['ArrowDown', 's', 'S'].includes(e.key)) move(0, 1);
            if (['ArrowLeft', 'a', 'A'].includes(e.key)) move(-1, 0);
            if (['ArrowRight', 'd', 'D'].includes(e.key)) move(1, 0);
        });

        // Start
        loadLevel(currentLevelIdx);
    </script>
</body>

</html>


