<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mirror Me - Harder Levels</title>
    <style>
        :root {
            --bg: #0f172a;
            --grid: #1e293b;
            --wall: #334155;
            --p1: #06b6d4;
            /* Cyan */
            --p2: #f43f5e;
            /* Rose */
            --goal-p1: rgba(6, 182, 212, 0.3);
            --goal-p2: rgba(244, 63, 94, 0.3);
            --text-glow: 0 0 10px rgba(255, 255, 255, 0.2);
        }

        body {
            background-color: var(--bg);
            color: white;
            font-family: 'Segoe UI', sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100vh;
            margin: 0;
            overflow: hidden;
            user-select: none;
        }

        h1 {
            margin-bottom: 5px;
            font-weight: 800;
            letter-spacing: 4px;
            text-transform: uppercase;
            text-shadow: var(--text-glow);
        }

        #game-container {
            position: relative;
            box-shadow: 0 0 40px rgba(0, 0, 0, 0.6);
            border: 4px solid var(--wall);
            border-radius: 4px;
        }

        canvas {
            display: block;
            background-color: var(--grid);
        }

        #ui {
            margin-top: 15px;
            text-align: center;
            color: #94a3b8;
            width: 600px;
        }

        .level-badge {
            background: #334155;
            padding: 5px 15px;
            border-radius: 20px;
            font-weight: bold;
            color: #fff;
            margin-bottom: 10px;
            display: inline-block;
        }

        .controls {
            margin-top: 10px;
            font-size: 0.85em;
            line-height: 1.6;
        }

        kbd {
            background: #1e293b;
            padding: 3px 8px;
            border-radius: 4px;
            font-family: 'Consolas', monospace;
            border: 1px solid #475569;
            box-shadow: 0 2px 0 #0f172a;
        }

        .reset-hint {
            color: #f43f5e;
            font-size: 0.8rem;
            margin-top: 5px;
            opacity: 0.8;
            font-weight: bold;
            cursor: pointer;
        }
    </style>
</head>

<body>

    <h1>Mirror Me</h1>
    <div class="level-badge">LEVEL <span id="level-display">1</span> / 55</div>

    <div id="game-container">
        <canvas id="gameCanvas"></canvas>
    </div>

    <div id="ui">
        <div class="controls">
            Move: <kbd>WASD</kbd> or <kbd>ARROWS</kbd> | Restart: <kbd>R</kbd><br>
            <span style="color:var(--p2)">Red</span> mirrors <span style="color:var(--p1)">Blue</span> horizontally.<br>
            <div class="reset-hint" onclick="loadLevel(currentLevelIdx)">Click here or press R if stuck</div>
        </div>
    </div>

    <script>
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');

        const TILE_SIZE = 35;
        let gridWidth = 15;
        let gridHeight = 9;

        const COLORS = {
            bg: '#1e293b', wall: '#475569', mirrorLine: '#64748b',
            p1: '#06b6d4', p2: '#f43f5e',
            goal1: 'rgba(6, 182, 212, 0.4)', goal2: 'rgba(244, 63, 94, 0.4)'
        };

        const LEVELS = [
            // --- 1-10: BASICS ---
            [ // 1 - The Squeeze
                "111111111111111",
                "1S00000100000S1",
                "101110010011101",
                "100010010010001",
                "100010010010001",
                "111010010010111",
                "1E00000100000E1",
                "111111111111111",
                "111111111111111"],

            [ // 2 - Asymmetric Halls
                "111111111111111",
                "1S00000100000S1",
                "111110010000111",
                "100000010000001",
                "100111010011101",
                "100000010000001",
                "111000010011111",
                "1E00000100000E1",
                "111111111111111"],

            [ // 3 - The Original (keeping your favorite!)
                "111111111111111",
                "1S00000100000S1",
                "100110010011001",
                "100110010011001",
                "100000010000001",
                "111100010001111",
                "1E00000100000E1",
                "111111111111111",
                "111111111111111"],

            [ // 4 - Split Paths
                "111111111111111",
                "1S00000100000S1",
                "101111010000001",
                "100001010011101",
                "100001010010001",
                "101111010011101",
                "1E00000100000E1",
                "111111111111111",
                "111111111111111"],

            [ // 5 - The Pinch
                "111111111111111",
                "1S00000100000S1",
                "100111010011101",
                "100001010000101",
                "111001010100111",
                "100001010000001",
                "100111010111101",
                "1E00000100000E1",
                "111111111111111"],

            [ // 6 - Offset Chambers
                "111111111111111",
                "1S00000100000S1",
                "101110010000001",
                "100000011111101",
                "100000010000001",
                "101111010000001",
                "100000010011101",
                "1E00000100000E1",
                "111111111111111"],

            [ // 7 - The Weave
                "111111111111111",
                "1S00000100000S1",
                "111011010110111",
                "100010010010001",
                "100110010011001",
                "100010010010001",
                "111011010110111",
                "1E00000100000E1",
                "111111111111111"],

            [ // 8 - Diagonal Drift
                "111111111111111",
                "1S00000100000S1",
                "111100010011001",
                "100000010000101",
                "100011010000001",
                "100001010000001",
                "111001010011111",
                "1E00000100000E1",
                "111111111111111"],

            [ // 9 - The Chokepoint
                "111111111111111",
                "1S00000100000S1",
                "101110010011101",
                "101000010000101",
                "100000000000001",
                "101000010000101",
                "101110010011101",
                "1E00000100000E1",
                "111111111111111"],

            [ // 10 - Mirror Maze
                "111111111111111",
                "1S00000100000S1",
                "100111010000001",
                "100001010111101",
                "111001010000101",
                "100001010110101",
                "100111010000001",
                "1E00000100000E1",
                "111111111111111"],

            // --- 11-20 ---
            [ // 11
                "111111111111111",
                "1S00100100100S1",
                "100010010010001",
                "101110000011101",
                "100000010000001",
                "101110000011101",
                "100010010010001",
                "1E00100100100E1",
                "111111111111111"],

            [ // 12 - NEW HARD LEVEL (The Ratchet)
                "111111111111111",
                "1S0000010000001", // Blue starts Top Left
                "1011111110111S1", // Red starts Top Right
                "101000010000101",
                "100010010010001",
                "111010010010111",
                "1E00100100100E1", // Both need to get to bottom corners
                "111111111111111",
                "111111111111111"],

            [ // 13
                "111111111111111",
                "100S0001000S001",
                "101111010111101",
                "101000010000101",
                "101011010110101",
                "101000010000101",
                "101111010111101",
                "100E0001000E001",
                "111111111111111"],

            [ // 14
                "111111111111111",
                "1S01000100010S1",
                "100100010001001",
                "100111000111001",
                "100001010100001",
                "111001010100111",
                "1E00000100000E1",
                "100000010000001",
                "111111111111111"],

            [ // 15
                "111111111111111",
                "111111111111111",
                "1S00000100000S1",
                "101101010101101",
                "101000000000101",
                "101111010111101",
                "100000010000001",
                "11110E010E01111",
                "111111111111111"],

            [ // 16
                "111111111111111",
                "1S00000100000S1",
                "111000000000111",
                "100011010110001",
                "101010010010101",
                "101011010110101",
                "100000000000001",
                "111110010011111",
                "1E00000100000E1"],

            [ // 17 (FIXED)
                "111111111111111",
                "1S00000100000S1",
                "101111010111101",
                "101000010000101",
                "101010111010101",
                "101000010000101",
                "101111010111101",
                "1E00000100000E1",
                "111111111111111"],

            [ // 18 - NEW HARD LEVEL (Vertical Desync)
                "111111111111111",
                "1S00000100000S1",
                "100000011100001", // Ceiling low on right side
                "100000010000001",
                "111000010000001",
                "100000000000001",
                "100111010111001",
                "1000E00100E0001",
                "111111111111111"],

            [ // 19
                "111111111111111",
                "1S01010101010S1",
                "100000000000001",
                "101010101010101",
                "100000000000001",
                "101010101010101",
                "100000000000001",
                "1E01010101010E1",
                "111111111111111"],

            [ // 20
                "111111111111111",
                "111S1111111S111",
                "100000000000001",
                "101101111101101",
                "101000000000101",
                "101101111101101",
                "100000000000001",
                "111E1111111E111",
                "111111111111111"],

            // --- 21-30 ---
            [ // 21 (FIXED)
                "111111111111111",
                "1S00000100000S1",
                "111110010011111",
                "100000010000001",
                "100111111111001",
                "100000010000001",
                "111110010011111",
                "1E00000100000E1",
                "111111111111111"],

            [ // 22
                "111111111111111",
                "1S00000000000S1",
                "101110010011101",
                "101000010000101",
                "101011111110101",
                "101000010000101",
                "101110010011101",
                "1E00000000000E1",
                "111111111111111"],

            [ // 23
                "111111111111111",
                "1S01000100010S1",
                "100101000101001",
                "100101111101001",
                "100000000000001",
                "111101010101111",
                "1E00000100000E1",
                "100000010000001",
                "111111111111111"],

            [ // 24 - NEW HARD LEVEL (The Staircase)
                "111111111111111",
                "1S00000100000S1",
                "111000010000111", // Narrow at top
                "100000010000001",
                "100100010001001", // Center Obstacles
                "100000010000001",
                "111000010000111", // Narrow at bottom
                "1E00000100000E1",
                "111111111111111"],

            [ // 25
                "111111111111111",
                "1S00000100000S1",
                "101110111011101",
                "100000000000001",
                "111011111110111",
                "100000000000001",
                "101110111011101",
                "1E00000100000E1",
                "111111111111111"],

            [ // 26
                "111111111111111",
                "1S00000000000S1",
                "101111101111101",
                "100000101000001",
                "111100101001111",
                "100000101000001",
                "101111101111101",
                "1E00000000000E1",
                "111111111111111"],

            [ // 27
                "111111111111111",
                "100S0001000S001",
                "100100000001001",
                "111111010111111",
                "100000010000001",
                "111111010111111",
                "100100000001001",
                "100E0001000E001",
                "111111111111111"],

            [ // 28
                "111111111111111",
                "1S00000100000S1",
                "111100010001111",
                "100000010000001",
                "101110010011101",
                "100000010000001",
                "111100010001111",
                "1E00000100000E1",
                "111111111111111"],

            [ // 29 (FIXED)
                "111111111111111",
                "1S01010101010S1",
                "100000010000001",
                "111011101110111",
                "100000010000001",
                "111011101110111",
                "100000010000001",
                "1E01010101010E1",
                "111111111111111"],

            [ // 30
                "111111111111111",
                "1S00000100000S1",
                "101111010111101",
                "100001010100001",
                "111101010101111",
                "100001010100001",
                "101111010111101",
                "1E00000100000E1",
                "111111111111111"],

            // --- 31-40 ---
            [ // 31
                "111111111111111",
                "1E00000100000E1",
                "101111000111101",
                "100000101000001",
                "111010101010111",
                "100000101000001",
                "101111000111101",
                "1S00000100000S1",
                "111111111111111"],

            [ // 32 - NEW HARD LEVEL (The Vice)
                "111111111111111",
                "1S00000100000S1",
                "101111000111101", // Tight squeeze top
                "100000101000001",
                "101010000010101", // Center open
                "100000101000001",
                "101111000111101", // Tight squeeze bottom
                "1E00000100000E1",
                "111111111111111"],

            [ // 33
                "111111111111111",
                "1S00000100000S1",
                "101111101111101",
                "101000010000101",
                "100000010000001",
                "101000010000101",
                "101111101111101",
                "1E00000100000E1",
                "111111111111111"],

            [ // 34
                "111111111111111",
                "1S00000100000S1",
                "101100010001101",
                "101101000101101",
                "100001010100001",
                "101101000101101",
                "101100010001101",
                "1E00000100000E1",
                "111111111111111"],

            [ // 35
                "111111111111111",
                "111111S1S111111",
                "110000010000011",
                "100000000000001",
                "101111111111101",
                "100000000000001",
                "110000010000011",
                "111111E1E111111",
                "111111111111111"],

            [ // 36
                "111111111111111",
                "1S00000000000S1",
                "101110101011101",
                "100010000010001",
                "100010111010001",
                "100010000010001",
                "101110101011101",
                "1E00000000000E1",
                "111111111111111"],

            [ // 37 (FIXED)
                "111111111111111",
                "1E00000100000E1",
                "111010010010111",
                "100010010010001",
                "101110010011101",
                "100010010010001",
                "111010010010111",
                "1S00000100000S1",
                "111111111111111"],

            [ // 38
                "111111111111111",
                "1S00000000000S1",
                "101000010000101",
                "101000010000101",
                "101000010000101",
                "101000010000101",
                "101000010000101",
                "1E00000000000E1",
                "111111111111111"],

            [ // 39
                "111111111111111",
                "1S00100100100S1",
                "100010000010001",
                "110010010010011",
                "110000010000011",
                "110010010010011",
                "100010000010001",
                "1E00100100100E1",
                "111111111111111"],

            [ // 40
                "111111111111111",
                "1S00001110000S1",
                "100000111000001",
                "100000111000001",
                "100000000000001",
                "100000111000001",
                "100000111000001",
                "1E00001110000E1",
                "111111111111111"],

            // --- 41-50 ---
            [ // 41
                "111111111111111",
                "1S00000000000S1",
                "101111101111101",
                "100000101000001",
                "101110101011101",
                "100000101000001",
                "101111101111101",
                "1E00000000000E1",
                "111111111111111"],

            [ // 42
                "111111111111111",
                "1S01000100010S1",
                "100100000001001",
                "101100000001101",
                "100100010001001",
                "101100000001101",
                "100100000001001",
                "1E01000100010E1",
                "111111111111111"],

            [ // 43
                "111111111111111",
                "1S00000100000S1",
                "100111000111001",
                "100001000100001",
                "111001000100111",
                "100001000100001",
                "100111000111001",
                "1E00000100000E1",
                "111111111111111"],

            [ // 44
                "111111111111111",
                "1S01010101010S1",
                "100000010000001",
                "100000000000001",
                "100000000000001",
                "100000000000001",
                "100000010000001",
                "1E01010101010E1",
                "111111111111111"],

            [ // 45 - NEW HARD LEVEL (The Cell)
                "111111111111111",
                "1S00000000000S1",
                "101111010111101", // Trap them near start
                "101000010000101",
                "101010111010101",
                "100000010000001", // One side has opening
                "101111010111101", // Trap near end
                "1E00000000000E1",
                "111111111111111"],

            [ // 46
                "111111111111111",
                "111111111111111",
                "1S00000000000S1",
                "101010000010101",
                "101010101010101",
                "101010000010101",
                "100000000000001",
                "1E00000000000E1",
                "111111111111111"],

            [ // 47
                "111111111111111",
                "1S00000100000S1",
                "111000000000111",
                "100000000000001",
                "100111101111001",
                "100000000000001",
                "111000000000111",
                "1E00000100000E1",
                "111111111111111"],

            [ // 48
                "111111111111111",
                "1S00100100100S1",
                "100110000011001",
                "100000101000001",
                "100110101011001",
                "100000101000001",
                "100110000011001",
                "1E00100100100E1",
                "111111111111111"],

            [ // 49
                "111111111111111",
                "100S0000000S001",
                "100000000000001",
                "100000000000001",
                "100000000000001",
                "100000000000001",
                "100000000000001",
                "100E0000000E001",
                "111111111111111"],

            [ // 50
                "111111111111111",
                "1S00000100000S1",
                "101111101111101",
                "101000000000101",
                "101011111110101",
                "101000000000101",
                "101111101111101",
                "1E00000100000E1",
                "111111111111111"],

            // --- 51-55: HARD CORE (21x13 Grid) ---
            [ // 51 - The Labyrinth
                "111111111111111111111",
                "1S000000000100000000S1",
                "10111111100100111111101",
                "10100000100100100000101",
                "10101110111111101110101",
                "10001000000100000010001",
                "11111011110101111011111",
                "10000010000100001000001",
                "10111110110101101111101",
                "10000000000000000000001",
                "10111111101110111111101",
                "1E000000000100000000E1",
                "111111111111111111111"
            ],
            [ // 52 - The Gauntlet
                "111111111111111111111",
                "1S000010000000010000S1",
                "111110101111101011111",
                "100000100000001000001",
                "101111111010111111101",
                "101000000010000000001",
                "101011111111111111101",
                "101000000000000000001",
                "101111111010111111101",
                "100000000010000000001",
                "111110101111101011111",
                "1E000000000000000000E1",
                "111111111111111111111"
            ],
            [ // 53 - Vertical Sync
                "111111111111111111111",
                "1S00100010001000100S1",
                "100010001000100010001",
                "101010101010101010101",
                "101000000000000000101",
                "101111101010101111101",
                "100000001000100000001",
                "101111101010101111101",
                "100000000000000000001",
                "101010101010101010101",
                "100010001111100010001",
                "1E00100010001000100E1",
                "111111111111111111111"
            ],
            [ // 54 - The Decoupler
                "111111111111111111111",
                "1S11000000000000011S1",
                "100001111111111100001",
                "101100010000010001101",
                "101001000111000100101",
                "101011010101010110101",
                "101000010000010000101",
                "101011011111110110101",
                "101000000000000000101",
                "101111111010111111101",
                "100000000010000000001",
                "1E000000000000000000E1",
                "111111111111111111111"
            ],
            [ // 55 - The Grandmaster
                "111111111111111111111",
                "1S00001000000010000S1",
                "111110111101111011111",
                "100000000101000000001",
                "101111110101011111101",
                "101000000101000000101",
                "101010111111111010101",
                "100010000000000010001",
                "101111101010101111101",
                "100000001010100000001",
                "101111111010111111101",
                "1E000000000000000000E1",
                "111111111111111111111"
            ],
        ];

        let currentLevelIdx = 0;
        let map = [];
        let p1 = { x: 0, y: 0 };
        let p2 = { x: 0, y: 0 };
        let exit1 = { x: 0, y: 0 };
        let exit2 = { x: 0, y: 0 };

        function loadLevel(idx) {
            if (idx >= LEVELS.length) {
                alert("ðŸŽ‰ CONGRATULATIONS! You have beaten all valid levels!");
                currentLevelIdx = 0;
                idx = 0;
            }

            document.getElementById('level-display').innerText = idx + 1;
            const layout = LEVELS[idx];
            map = [];

            // Set dynamic grid size
            gridHeight = layout.length;
            gridWidth = layout[0].length;
            canvas.width = gridWidth * TILE_SIZE;
            canvas.height = gridHeight * TILE_SIZE;

            // Reset positions
            exit1 = { x: 0, y: 0 }; exit2 = { x: 0, y: 0 };

            // Center UI
            document.getElementById('ui').style.width = canvas.width + "px";

            for (let y = 0; y < layout.length; y++) {
                let row = [];
                for (let x = 0; x < layout[y].length; x++) {
                    const char = layout[y][x];
                    row.push(char === '1' ? 1 : 0);

                    // Left side logic
                    if (x < Math.floor(gridWidth / 2)) {
                        if (char === 'S') p1 = { x, y };
                        if (char === 'E') exit1 = { x, y };
                    }
                    // Right side logic
                    else if (x > Math.floor(gridWidth / 2)) {
                        if (char === 'S') p2 = { x, y };
                        if (char === 'E') exit2 = { x, y };
                    }
                    // Center Line logic
                    else {
                        if (char === 'S') p1 = { x, y };
                    }
                }
                map.push(row);
            }
            draw();
        }
        function move(dx, dy) {
            const t1 = { x: p1.x + dx, y: p1.y + dy };
            // MIRROR MECHANIC: Red gets -dx, but SAME dy
            const t2 = { x: p2.x - dx, y: p2.y + dy };

            // Try Moving P1
            if (isValid(t1.x, t1.y)) {
                p1 = t1;
            }

            // Try Moving P2 (Independently of P1)
            if (isValid(t2.x, t2.y)) {
                p2 = t2;
            }

            draw();
            checkWin();
        }

        function isValid(x, y) {
            if (x < 0 || x >= gridWidth || y < 0 || y >= gridHeight) return false;
            return map[y][x] !== 1;
        }

        function checkWin() {
            if (p1.x === exit1.x && p1.y === exit1.y &&
                p2.x === exit2.x && p2.y === exit2.y) {
                setTimeout(() => {
                    currentLevelIdx++;
                    loadLevel(currentLevelIdx);
                }, 150);
            }
        }

        function draw() {
            ctx.fillStyle = COLORS.bg;
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            // Draw Map
            for (let y = 0; y < map.length; y++) {
                for (let x = 0; x < map[y].length; x++) {
                    if (map[y][x] === 1) {
                        const px = x * TILE_SIZE, py = y * TILE_SIZE;
                        ctx.fillStyle = COLORS.wall;
                        ctx.fillRect(px, py, TILE_SIZE, TILE_SIZE);
                        ctx.strokeStyle = '#5c6b7f';
                        ctx.lineWidth = 1;
                        ctx.strokeRect(px + 1, py + 1, TILE_SIZE - 2, TILE_SIZE - 2);
                    }
                }
            }

            // Mirror Line
            const midX = Math.floor(gridWidth / 2) * TILE_SIZE + TILE_SIZE / 2;
            ctx.strokeStyle = COLORS.mirrorLine;
            ctx.setLineDash([5, 5]);
            ctx.lineWidth = 2;
            ctx.beginPath();
            ctx.moveTo(midX, 0);
            ctx.lineTo(midX, canvas.height);
            ctx.stroke();
            ctx.setLineDash([]);

            // Exits
            const inset = 6;
            drawEntity(exit1.x, exit1.y, COLORS.goal1, false);
            drawEntity(exit2.x, exit2.y, COLORS.goal2, false);

            ctx.lineWidth = 2;
            ctx.strokeStyle = COLORS.p1;
            ctx.strokeRect(exit1.x * TILE_SIZE + inset, exit1.y * TILE_SIZE + inset, TILE_SIZE - (inset * 2), TILE_SIZE - (inset * 2));

            ctx.strokeStyle = COLORS.p2;
            ctx.strokeRect(exit2.x * TILE_SIZE + inset, exit2.y * TILE_SIZE + inset, TILE_SIZE - (inset * 2), TILE_SIZE - (inset * 2));

            // Players
            drawEntity(p1.x, p1.y, COLORS.p1, true);
            drawEntity(p2.x, p2.y, COLORS.p2, true);
        }

        function drawEntity(x, y, color, isCircle) {
            ctx.fillStyle = color;
            const px = x * TILE_SIZE + TILE_SIZE / 2;
            const py = y * TILE_SIZE + TILE_SIZE / 2;

            if (isCircle) {
                ctx.shadowColor = color;
                ctx.shadowBlur = 10;
                ctx.beginPath();
                ctx.arc(px, py, TILE_SIZE / 3.5, 0, Math.PI * 2);
                ctx.fill();
                ctx.shadowBlur = 0;
            } else {
                ctx.fillRect(x * TILE_SIZE + 6, y * TILE_SIZE + 6, TILE_SIZE - 12, TILE_SIZE - 12);
            }
        }

        window.addEventListener('keydown', (e) => {
            if (e.key === 'r' || e.key === 'R') loadLevel(currentLevelIdx);
            if (['ArrowUp', 'w', 'W'].includes(e.key)) move(0, -1);
            if (['ArrowDown', 's', 'S'].includes(e.key)) move(0, 1);
            if (['ArrowLeft', 'a', 'A'].includes(e.key)) move(-1, 0);
            if (['ArrowRight', 'd', 'D'].includes(e.key)) move(1, 0);
        });

        // Start
        loadLevel(0);
    </script>
</body>

</html>